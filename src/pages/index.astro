---
import Layout from '../layouts/Layout.astro';
import WhySection from '../components/WhySection.astro';
import ContactSection from '../components/ContactSection.astro';
import Footer from '../components/Footer.astro';
import Navigation from '../components/Navigation';
import DecryptedText from '../components/DecryptedText.astro';
import HomeAuthSection from '../components/HomeAuthSection.astro';
import { URLS } from '../constants';
import logo from '../assets/logo.svg';
---

<Layout>
    <div class="landing-page">
        <Navigation client:load isScrolled={false} showWaitlist={false} />
        <header class="hero">
            <img src={logo.src} alt="ProxLock Logo" class="hero-logo" />
            <div class="container">
                <h1 class="hero-title" id="hero-title">ProxLock</h1>
                <p class="hero-subtitle" id="hero-subtitle">
                    <DecryptedText
                        text="Secure API Proxy Management"
                        speed={50}
                    />
                </p>
                <p class="hero-description">
                    Protect and manage your API keys with ease. ProxLock provides a secure gateway
                    for your applications, ensuring your sensitive credentials stay safe.
                </p>
                <div class="hero-actions">
                    <a href={URLS.DOCS} class="btn btn-secondary"><span>Docs</span></a>
                    <a href={URLS.APP} class="btn btn-primary" id="waitlist-btn"><span>Get Started</span></a>
                </div>
            </div>
        </header>

        <WhySection />

        <section id="how-it-works" class="how-it-works">
            <div class="container">
                <h2 class="section-title">How It Works</h2>
                <div class="how-it-works-content">
                    <div class="how-it-works-subsection">
                        <h3 class="subsection-title">Key Storage & Splitting</h3>
                        <p class="how-it-works-description">
                            ProxLock uses an XORed partial key system to ensure your complete API key is never stored in one place.
                            When you upload your API key to ProxLock, we split it into two partial keys, so we don't know your complete key either.
                        </p>
                    </div>
                    <div class="how-it-works-subsection">
                        <h3 class="subsection-title">Dynamic Proxying</h3>
                        <p class="how-it-works-description">
                            When your app makes an API request, ProxLock routes it through our secure proxy infrastructure.
                            We validate the app instance using Apple's Device Check to ensure authenticity and prevent unauthorized access.
                            The bearer token is then dynamically constructed by combining the partial keys, and the request is forwarded
                            to the target service with proper authentication, which is then relayed back to your app.
                            This process ensures your credentials remain secure while
                            maintaining minimal latency and maximum reliability.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section id="open-source" class="open-source">
            <div class="container">
                <h2 class="section-title">Source Available</h2>
                <p class="open-source-description">
                    ProxLock is built with transparency in mind. Our entire codebase is source available and published on GitHub.
                    We believe in security through openness, not obscurity.
                </p>

                <div class="open-source-grid">
                    <a href={URLS.GITHUB_BACKEND} target="_blank" rel="noopener noreferrer" class="repo-card">
                        <h3 class="repo-title">Backend</h3>
                        <p class="repo-description">The core API proxy and key management infrastructure.</p>
                        <div class="repo-link">View Repository →</div>
                    </a>

                    <a href={URLS.GITHUB_FRONTEND} target="_blank" rel="noopener noreferrer" class="repo-card">
                        <h3 class="repo-title">Frontend</h3>
                        <p class="repo-description">The dashboard for managing your API keys and projects.</p>
                        <div class="repo-link">View Repository →</div>
                    </a>

                    <a href={URLS.GITHUB_LANDING} target="_blank" rel="noopener noreferrer" class="repo-card">
                        <h3 class="repo-title">Landing Page</h3>
                        <p class="repo-description">This website! See how we present ProxLock to the world.</p>
                        <div class="repo-link">View Repository →</div>
                    </a>
                </div>

                <div class="open-source-actions">
                    <a href={URLS.GITHUB} target="_blank" rel="noopener noreferrer" class="btn btn-secondary">
                        View Organization
                    </a>
                </div>
            </div>
        </section>

        <section id="platforms" class="supported-platforms">
            <div class="container">
                <h2 class="section-title">Supported Platforms</h2>
                <div class="platforms-grid">
                    <div class="platform-card platform-card-active">
                        <div class="platform-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                                <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z" />
                            </svg>
                        </div>
                        <div class="platform-info">
                            <div class="platform-name-row">
                                <span class="platform-name">Apple</span>
                                <span class="platform-check">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" />
                                    </svg>
                                </span>
                            </div>
                            <span class="platform-subtitle">September 2025</span>
                        </div>
                    </div>
                    <div class="platform-card platform-card-active">
                        <div class="platform-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z" />
                            </svg>
                        </div>
                        <div class="platform-info">
                            <div class="platform-name-row">
                                <span class="platform-name">Web</span>
                                <span class="platform-check">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" />
                                    </svg>
                                </span>
                            </div>
                            <span class="platform-subtitle">January 2026</span>
                            <span class="platform-subtitle platform-sdk-coming-soon">SDK Coming Soon</span>
                        </div>
                    </div>
                    <div class="platform-card platform-card-active">
                        <div class="platform-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                                <path d="M17.6 9.48l1.84-3.18c.16-.31.04-.69-.26-.85-.29-.15-.65-.06-.83.22l-1.88 3.24c-1.39-.59-2.94-.92-4.47-.92s-3.08.33-4.47.92L5.65 5.67c-.19-.29-.55-.38-.84-.22-.3.16-.42.54-.26.85L6.4 9.48C3.3 11.25 1.28 14.44 1 18h22c-.28-3.56-2.3-6.75-5.4-8.52zM7 15.25c-.69 0-1.25-.56-1.25-1.25s.56-1.25 1.25-1.25 1.25.56 1.25 1.25-.56 1.25-1.25 1.25zm10 0c-.69 0-1.25-.56-1.25-1.25s.56-1.25 1.25-1.25 1.25.56 1.25 1.25-.56 1.25-1.25 1.25z" />
                            </svg>
                        </div>
                        <div class="platform-info">
                            <div class="platform-name-row">
                                <span class="platform-name">Android</span>
                                <span class="platform-check">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" />
                                    </svg>
                                </span>
                            </div>
                            <span class="platform-subtitle">January 2026</span>
                            <span class="platform-subtitle platform-sdk-coming-soon">SDK Coming Soon</span>
                        </div>
                    </div>
                    <div class="platform-card platform-card-active">
                        <div class="platform-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="48" height="48">
                                <circle cx="12" cy="12" r="2" fill="currentColor" stroke="none" />
                                <ellipse cx="12" cy="12" rx="10" ry="4.5" />
                                <ellipse cx="12" cy="12" rx="10" ry="4.5" transform="rotate(60 12 12)" />
                                <ellipse cx="12" cy="12" rx="10" ry="4.5" transform="rotate(120 12 12)" />
                            </svg>
                        </div>
                        <div class="platform-info">
                            <div class="platform-name-row">
                                <span class="platform-name">React Native</span>
                                <span class="platform-check">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" />
                                    </svg>
                                </span>
                            </div>
                            <span class="platform-subtitle">January 2026</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="signup" class="cta">
            <div class="container">
                <h2 class="cta-title">Ready to Get Started?</h2>
                <p class="cta-description">
                    Join our beta program and get started today.
                </p>
                <HomeAuthSection />
            </div>
        </section>

        <ContactSection />

        <Footer footnote="<sup>1</sup> Subject to the security guarantees of the underlying platform attestation services (e.g. Apple DeviceCheck, Google Play Integrity)." />
    </div>
</Layout>

<script>
    // Client-side scroll handling for Navigation
    document.addEventListener('DOMContentLoaded', () => {
        const heroTitle = document.getElementById('hero-title');
        const heroSubtitle = document.getElementById('hero-subtitle');
        const waitlistBtn = document.getElementById('waitlist-btn');
        
        const handleScroll = () => {
            const isMobile = window.innerWidth <= 768;
            const targetElement = isMobile ? heroSubtitle : heroTitle;
            
            if (targetElement) {
                const threshold = targetElement.offsetTop + targetElement.offsetHeight - (isMobile ? 0 : 50);
                const isScrolled = window.scrollY > threshold;
                
                // Dispatch custom event for Navigation component
                window.dispatchEvent(new CustomEvent('scroll-state-change', { 
                    detail: { isScrolled } 
                }));
            }
            
            if (waitlistBtn) {
                const rect = waitlistBtn.getBoundingClientRect();
                const showWaitlist = rect.bottom < 0;
                
                window.dispatchEvent(new CustomEvent('waitlist-visibility-change', { 
                    detail: { showWaitlist } 
                }));
            }
        };
        
        window.addEventListener('scroll', handleScroll);
        handleScroll(); // Initial check
    });
</script>
